
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>4. Build a Tree Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-katex/katex.min.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="Testing.html" />
    
    
    <link rel="prev" href="Metrics.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    1. Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="CART.html">
            
                <a href="CART.html">
            
                    
                    2. CART for Decision Tree
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="CART.html">
            
                <a href="CART.html#21-general-structure">
            
                    
                    2.1 General Structure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="CART.html">
            
                <a href="CART.html#22-overview-of-the-cart-algorithm-flow">
            
                    
                    2.2 Overview of the CART Algorithm Flow
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="Metrics.html">
            
                <a href="Metrics.html">
            
                    
                    3. Metrics to Decide a Good Split
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="Metrics.html">
            
                <a href="Metrics.html#31-gini-impurity">
            
                    
                    3.1 Gini Impurity
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="Metrics.html">
            
                <a href="Metrics.html#32--entropy">
            
                    
                    3.2 Entropy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="Metrics.html">
            
                <a href="Metrics.html#33-mean-squared-error-mse">
            
                    
                    3.3 Mean Squared Error (MSE)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="Metrics.html">
            
                <a href="Metrics.html#34-finding-the-best-split">
            
                    
                    3.4 Finding the best split
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter active" data-level="1.4" data-path="Build_tree.html">
            
                <a href="Build_tree.html">
            
                    
                    4. Build a Tree
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="Testing.html">
            
                <a href="Testing.html">
            
                    
                    5. Testing the Algorithm
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="Testing.html">
            
                <a href="Testing.html#51-testing-case-predicting-breast-cancer">
            
                    
                    5.1 Classification
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1" data-path="Testing.html">
            
                <a href="Testing.html#511-decision-tree-visualization">
            
                    
                    5.1.1 Decision Tree Visualization
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="Testing.html">
            
                <a href="Testing.html#52-testing-case-predicting-diabetes">
            
                    
                    5.2 Regression
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="conclusion.html">
            
                <a href="conclusion.html">
            
                    
                    6. Conclusion
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >4. Build a Tree</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="4-build-a-tree">4. Build a Tree</h1>
<p><strong>Now that we&apos;ve defined all the necessary helper functions, it&apos;s time to put everything together and build the decision tree&#x1F333;!</strong></p>
<p>The DecisionTree class is designed to handle both classification and regression tasks. As previouly introduced, a decision tree built using the CART algorithm relies on recursively splitting the dataset into smaller subsets. However, this process cannot be endless. To successfully construct a tree, we need to define stopping criteria (e.g., maximum tree depth, minimum number of samples, or reaching a pure region).</p>
<p>Once the stopping criteria are met, the algorithm must terminate the recursion and assign a prediction to the node, which becomes a leaf node. To achieve this, I created a leaf_node function first within the class. This function ensures that predictions are assigned to nodes where further splitting is not possible, either because the data cannot be split further or the stopping conditions have been reached. </p>
<p>The fit function orchestrates the training process by invoking the recursive_splitting function, which builds the tree step-by-step. Once the tree is built, it is stored in the self.tree attribute.</p>
<p>The predict function is used to traverse the built tree and generate predictions for new input samples. Starting from the root node, it follows the feature-based split conditions until it reaches a leaf node, where the prediction is returned. This function allows the trained decision tree to be applied effectively to unseen data.</p>
<pre><code class="lang-python"><span class="hljs-comment"># Build a tree</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DecisionTree</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, task = <span class="hljs-string">&apos;classification&apos;</span>, criterion = <span class="hljs-string">&apos;gini&apos;</span>, min_sample=<span class="hljs-number">2</span>, max_depth=None)</span>:</span>
        self.task = task 
        self.criterion = criterion
        self.min_sample = min_sample
        self.max_depth = max_depth
        self.tree = <span class="hljs-keyword">None</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">leaf_node</span><span class="hljs-params">(self, data, target_index)</span>:</span>
        target_val = [row[target_index] <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> data]
        <span class="hljs-keyword">if</span> self.task == <span class="hljs-string">&apos;classification&apos;</span>:
             <span class="hljs-comment"># Find the most frequent element (class label) in the list</span>
            <span class="hljs-keyword">return</span> max(set(target_val), key = target_val.count)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> np.mean(target_val)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">recursive_splitting</span><span class="hljs-params">(self, data, target_index, depth = <span class="hljs-number">0</span>)</span>:</span>
        <span class="hljs-comment"># Define a stopping criteria </span>
        <span class="hljs-keyword">if</span> depth &gt;= self.max_depth <span class="hljs-keyword">or</span> len(data)&lt; self.min_sample:
            <span class="hljs-keyword">return</span> self.leaf_node(data, target_index)

        <span class="hljs-comment"># Use the previously defined function to find the best split</span>
        best_feature_index, best_threshold, best_score = find_best_split(data, target_index)
        <span class="hljs-keyword">if</span> best_feature_index <span class="hljs-keyword">is</span> <span class="hljs-keyword">None</span>:
            <span class="hljs-keyword">return</span> self.leaf_node(data, target_index)

        <span class="hljs-comment"># Use the previously defined function to split the data</span>
        left, right = split_data (best_feature_index, best_threshold, data)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> left <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> right: <span class="hljs-comment"># empty groups</span>
            <span class="hljs-keyword">return</span> self.leaf_node(data, target_index)

        <span class="hljs-comment"># Initiate the recursive process to build the right and left trees respectively </span>
        left_tree = self.recursive_splitting(left, target_index, depth + <span class="hljs-number">1</span>)
        right_tree = self.recursive_splitting(right, target_index, depth + <span class="hljs-number">1</span>)

        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">&apos;feature&apos;</span>: best_feature_index,
            <span class="hljs-string">&apos;threshold&apos;</span>: best_threshold,
            <span class="hljs-string">&apos;left&apos;</span>: left_tree,
            <span class="hljs-string">&apos;right&apos;</span>: right_tree
        }

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fit</span><span class="hljs-params">(self, data, target_index)</span>:</span>
        self.tree = self.recursive_splitting(data, target_index)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">predict</span><span class="hljs-params">(self, row)</span>:</span>
        <span class="hljs-string">&apos;&apos;&apos;
        While not a leaf, evaluate the feature against the threshold 
        and update the node either to the left or right subtree.
        &apos;&apos;&apos;</span>
        node = self.tree <span class="hljs-comment"># initiate a root node</span>

        <span class="hljs-comment"># Check whether the node is a terminal node. Terminal nodes will be stored in as dictionaries.</span>
        <span class="hljs-comment"># In contrast, if the node is a leaf node, it will not be a dictionary but a single value like a class label</span>
        <span class="hljs-comment"># for classification or a numerical value a numeric prediction for regression. In that case, the loop stops.  </span>
        <span class="hljs-keyword">while</span> isinstance(node, dict):  
            <span class="hljs-keyword">if</span> row[node[<span class="hljs-string">&apos;feature&apos;</span>]] &lt;= node[<span class="hljs-string">&apos;threshold&apos;</span>]:
                node = node[<span class="hljs-string">&apos;left&apos;</span>]
            <span class="hljs-keyword">else</span>:
                node = node[<span class="hljs-string">&apos;right&apos;</span>]
        <span class="hljs-keyword">return</span> node
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="Metrics.html#34-finding-the-best-split" class="navigation navigation-prev " aria-label="Previous page: 3.4 Finding the best split">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="Testing.html" class="navigation navigation-next " aria-label="Next page: 5. Testing the Algorithm">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"4. Build a Tree","level":"1.4","depth":1,"next":{"title":"5. Testing the Algorithm","level":"1.5","depth":1,"path":"Testing.md","ref":"Testing.md","articles":[{"title":"5.1 Classification","level":"1.5.1","depth":2,"anchor":"#51-testing-case-predicting-breast-cancer","path":"Testing.md","ref":"Testing.md#51-testing-case-predicting-breast-cancer","articles":[{"title":"5.1.1 Decision Tree Visualization","level":"1.5.1.1","depth":3,"anchor":"#511-decision-tree-visualization","path":"Testing.md","ref":"Testing.md#511-decision-tree-visualization","articles":[]}]},{"title":"5.2 Regression","level":"1.5.2","depth":2,"anchor":"#52-testing-case-predicting-diabetes","path":"Testing.md","ref":"Testing.md#52-testing-case-predicting-diabetes","articles":[]}]},"previous":{"title":"3.4 Finding the best split","level":"1.3.4","depth":2,"anchor":"#34-finding-the-best-split","path":"Metrics.md","ref":"Metrics.md#34-finding-the-best-split","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["katex","livereload"],"pluginsConfig":{"katex":{"delimiters":[{"left":"$$","right":"$$","display":true},{"left":"$","right":"$","display":false}]},"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css","website":"styles/website.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css","website":"styles/website.css"}},"file":{"path":"Build_tree.md","mtime":"2025-01-16T01:54:38.690Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2025-01-16T03:41:16.709Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

